<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø®ØªØ¨Ø± Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ - Ø¬ÙŠÙ…ÙŠÙ†Ø§ÙŠ</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a2e; color: white; margin: 20px; }
        .container { display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        .panel { background: #16213e; padding: 20px; border-radius: 10px; border: 1px solid #0f3460; }
        .log-panel { background: #000; color: #00ff41; font-family: 'Courier New', monospace; padding: 15px; height: 500px; overflow-y: auto; border-radius: 5px; font-size: 13px; }
        .input-group { margin-bottom: 15px; border-bottom: 1px solid #0f3460; padding-bottom: 10px; }
        label { display: block; font-size: 12px; color: #add8e6; margin-bottom: 5px; }
        input[type="number"] { width: 60px; background: #0f3460; border: none; color: white; padding: 5px; border-radius: 3px; }
        button { background: #e94560; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; }
        button:hover { background: #ff4d6d; }
        .step-info { color: #f9d342; margin: 5px 0; border-right: 2px solid #f9d342; padding-right: 10px; }
        .visualizer { display: grid; gap: 2px; margin-top: 20px; background: #333; padding: 5px; }
        .cell { width: 25px; height: 25px; background: #1a1a2e; display: flex; align-items: center; justify-content: center; font-size: 10px; }
        .cell.block { background: #e94560; }
        .cell.switch { background: #00ff41; color: black; }
        .cell.bomb { background: #f9d342; color: black; }
    </style>
</head>
<body>

<h2>ðŸ§ª Ù…Ø®ØªØ¨Ø± Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ (Scaling Algorithm)</h2>

<div class="container">
    <div class="panel">
        <div class="input-group">
            <label>Ø­Ø¬Ù… Ø§Ù„Ø´Ø¨ÙƒØ© (Min - Max)</label>
            X: <input type="number" id="aiGridXMin" value="5"> - <input type="number" id="aiGridXMax" value="10">
            <br>
            Y: <input type="number" id="aiGridYMin" value="5"> - <input type="number" id="aiGridYMax" value="10">
        </div>

        <div class="input-group">
            <input type="checkbox" id="aiAllowBlocks" checked> <label style="display:inline">Blocks (Min/Max)</label><br>
            <input type="number" id="aiBlocksMin" value="10"> - <input type="number" id="aiBlocksMax" value="30">
        </div>

        <div class="input-group">
            <input type="checkbox" id="aiAllowSwitches" checked> <label style="display:inline">Switches (Min/Max)</label><br>
            <input type="number" id="aiSwitchesMin" value="5"> - <input type="number" id="aiSwitchesMax" value="15">
        </div>

        <div class="input-group">
            <input type="checkbox" id="aiAllowMustBombs" checked> <label style="display:inline">MustBombs (Min/Max)</label><br>
            <input type="number" id="aiMustBombsMin" value="2"> - <input type="number" id="aiMustBombsMax" value="8">
        </div>

        <button onclick="runTest()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Start ðŸš€</button>
    </div>

    <div class="panel">
        <h3>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Execution Steps):</h3>
        <div id="log" class="log-panel"></div>
        <div id="gridVisualizer" class="visualizer"></div>
    </div>
</div>

<script>
    // --- Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† (Helpers Simulation) ---
    const Helpers = {
        getVal: (id) => parseInt(document.getElementById(id).value) || 0,
        getChecked: (id) => document.getElementById(id).checked,
        getRandom: (min, max) => Math.floor(Math.random() * (max - min + 1)) + min,
        shuffleArray: (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    };

    const StarConditions = {
        generate: (config, logFn) => {
            logFn("--- Ø®Ø·ÙˆØ© 6: ØªÙˆÙ„ÙŠØ¯ Ø´Ø±ÙˆØ· Ø§Ù„Ù†Ø¬ÙˆÙ… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ²Ø¹Ø©.");
            return ["Condition 1", "Condition 2"];
        }
    };

    // --- Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ---
    class ConfigGenerator {
        static generate(logFn) {
            logFn("ðŸš€ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙˆÙ„ÙŠØ¯...");
            
            // 1. ØªØ­Ø¯ÙŠØ¯ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ©
            const cols = Helpers.getRandom(Helpers.getVal('aiGridXMin'), Helpers.getVal('aiGridXMax'));
            const rows = Helpers.getRandom(Helpers.getVal('aiGridYMin'), Helpers.getVal('aiGridYMax'));
            const totalCells = cols * rows;
            const maxAllowedTotal = Math.floor(totalCells / 2);
            
            logFn(`ðŸ“ Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„Ø´Ø¨ÙƒØ© [${cols}x${rows}] | Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙƒÙ„ÙŠØ©: ${totalCells} | Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ (M/2): ${maxAllowedTotal}`);

            // 2. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…ØµÙÙˆÙØ©
            const allIndices = Array.from({ length: totalCells }, (_, i) => i);
            Helpers.shuffleArray(allIndices);
            logFn("ðŸ”€ Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙˆØ¨Ø¹Ø«Ø±ØªÙ‡Ø§ (Shuffle).");

            // 3. Ø§Ù„Ø±ØºØ¨Ø§Øª
            const types = [
                { id: 'Blocks', chk: 'aiAllowBlocks', min: 'aiBlocksMin', max: 'aiBlocksMax' },
                { id: 'Switches', chk: 'aiAllowSwitches', min: 'aiSwitchesMin', max: 'aiSwitchesMax' },
                { id: 'MustBombs', chk: 'aiAllowMustBombs', min: 'aiMustBombsMin', max: 'aiMustBombsMax' }
            ];

            let activeTypes = types.filter(t => Helpers.getChecked(t.chk));
            let totalDesire = 0;

            logFn("ðŸ“‹ Ø§Ù„Ø®Ø·ÙˆØ© 3: ØªØ­Ù„ÙŠÙ„ Ø±ØºØ¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...");
            activeTypes.forEach(t => {
                t.desire = Helpers.getRandom(Helpers.getVal(t.min), Helpers.getVal(t.max));
                if (t.desire > maxAllowedTotal) {
                    logFn(`âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø±ØºØ¨Ø© ${t.id} (${t.desire}) ØªØªØ®Ø·Ù‰ M/2ØŒ ØªÙ… Ø®ÙØ¶Ù‡Ø§ Ù„Ù€ ${maxAllowedTotal}`);
                    t.desire = maxAllowedTotal;
                }
                totalDesire += t.desire;
                logFn(`- Ø¹Ù†ØµØ± ${t.id} ÙŠØ·Ù„Ø¨: ${t.desire} Ø®Ù„ÙŠØ©.`);
            });

            // 4. Ø§Ù„ØªÙˆØ²ÙŠÙ† (Scaling)
            logFn(`âš–ï¸ Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØºØ¨Ø§Øª = ${totalDesire}. ÙˆØ§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ = ${maxAllowedTotal}`);
            const scale = totalDesire > maxAllowedTotal ? (maxAllowedTotal / totalDesire) : 1;
            
            if (scale < 1) {
                logFn(`ðŸ“‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø³Ù…ÙˆØ­! ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹Ø§Ù…Ù„ ØªØµØºÙŠØ± (Scale): ${scale.toFixed(2)}`);
            } else {
                logFn(`âœ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø¢Ù…Ù†. Ù„Ù† ÙŠØªÙ… ØªØµØºÙŠØ± Ø§Ù„Ù‚ÙŠÙ….`);
            }

            const results = { Blocks: [], Switches: [], MustBombs: [] };
            
            activeTypes.forEach(t => {
                const finalCount = Math.floor(t.desire * scale);
                logFn(`ðŸ”¹ ${t.id}: Ø§Ù„Ø·Ù„Ø¨ ${t.desire} -> Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ${finalCount}`);
                results[t.id] = allIndices.splice(0, finalCount);
            });

            // 5. Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙƒØ§Ø¦Ù†
            const config = {
                rows, cols,
                blocks: results.Blocks,
                switches: results.Switches,
                mustBombs: results.MustBombs,
                starConditions: []
            };

            config.starConditions = StarConditions.generate(config, logFn);
            logFn("âœ¨ ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!");
            return config;
        }
    }

    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
    function runTest() {
        const logDiv = document.getElementById('log');
        const gridDiv = document.getElementById('gridVisualizer');
        logDiv.innerHTML = ''; 
        gridDiv.innerHTML = '';

        const logger = (msg) => {
            const div = document.createElement('div');
            div.className = 'step-info';
            div.innerText = msg;
            logDiv.appendChild(div);
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        const config = ConfigGenerator.generate(logger);
        
        // Ø±Ø³Ù… Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø¨ØµØ±ÙŠ
        gridDiv.style.gridTemplateColumns = `repeat(${config.cols}, 25px)`;
        for(let i=0; i < (config.cols * config.rows); i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            if (config.blocks.includes(i)) cell.className += ' block';
            if (config.switches.includes(i)) cell.className += ' switch';
            if (config.mustBombs.includes(i)) cell.className += ' bomb';
            gridDiv.appendChild(cell);
        }
    }
</script>
</body>
</html>